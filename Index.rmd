---
title: "Predicting Health Outcome"
author: "Olamide Adu"
date: "2023-03-25"
output:
  html_document:
    toc: true
    toc_depth: 2
    toc_float: true
    dev: svg
    theme: simplex
    highlight: zenburn
    code_folding: show
    df_print: paged
editor_options: 
  markdown: 
    wrap: 72
---

# Retrospective Health-data Analysis
Retrospective exploratory data analysis of intensive care unit health-data downloaded from kaggle.com already preprocessed by user @saurabhshahane.

**NB**: The [data](https://www.kaggle.com/datasets/saurabhshahane/in-hospital-mortality-prediction) used is part of a whole data from [**MIMIC III original database**](https://www.kaggle.com/datasets/drscarlat/mimic2-original-icu/download?datasetVersionNumber=1).

Mainly
![R](https://raw.githubusercontent.com/xrander/Health-data/master/Resource/4375063_logo_project_r_icon.png)
and
![](https://github.com/xrander/Health-data/raw/master/Resource/4691328_postgresql_icon.png)

## The Data
We load the libraries for reading and analyzing the data first.

```{r load_libraries, message=FALSE, results='hide'}
# Load the doBy library for advanced data manipulation and data aggregation
library('doBy')

# Load the tidyverse library for data manipulation and visualization
library('tidyverse')

# Load corrplot package for correlation matrix
library('corrplot')

# Load Hmisc to impute missing values
library("e1071")
```
Next we import the data.frame

```{r load_data, message = FALSE, cols.print = 15}
# Import the data
health_rec <- read_csv('https://raw.githubusercontent.com/xrander/Health-data/master/Health_data.csv')

# Preview the first ten rows of the data
head(health_rec, n = 10)
```

# Description of the Data

The MIMIC-III database is publicly a available critical care database containing de-identified data on 46520 patients and 58976 admissions to the ICU of the Beth Israel Deaconess Medical Center, Boston, USA between
2001 and 2008. The data used for this study is limited to a bit more than 1000 patient only.
![](https://news.mit.edu/sites/default/files/images/202207/MIT-Healthcare-Technology-01.jpg)

## Data Definition

-   group_num

-   ID: The patient ID

-   outcome: 0 = Alive and 1 = Dead

-   age: the age of the patient

-   gender: 1 = Male and 2 = Female

-   BMI: Body Mass Index

-   hypertensive: 0 = with and 1 = without

-   atrialfibrillation: 0 = with and 1 = without

-   CHD_with_no_MI: Coronary heart disease with Myocardial infarction, 0 = with and 1 without

-   diabetes: 0 = with and 1 without

-   deficiencyanemias: 0 = with and 1 = without

-   depression: 0 = with and 1 = without

-   Hyperlipemia:this refers to high concentration of fats or lipids in the blood. 0 = with and 1 = without

-   Renal_failure: 0 = without renal failure and 1 = with renal failure

-   COPD: chronic obstructive pulmonary disease(A disease causing airflow blockage and breathing related problems). 0 = without and 1 = without

-   heart_rate: a range of 60 to 100 bpm is considered normal

-   Systolic_blood_pressure: measure of the pressure in arteries when the heart beats.

-   Diastolic_blood_pressure: measure of the pressure in the arteries when the heart rests between beats

-   Respiratory_rate: this is the number of breathes per minute. The normal range is between 12-20, anything under above or below this range is abnormal. 25 is considered too high.

-   temperature

-   SP_O2: Oxygen saturation (measure of how much oxygen the blood carries as a percentage of the maximum it could carry). The normal range for healthy individuals is between 96% to 99%

-   Urine_output

-   hematocrit: percentage volume of red blood cells in the blood.

-   RBC: acronym for Red Blood Count.

-   MCH: Mean Corpuscular Hemoglobin, this is the average amount of hemoglobin in each of the red blood cells

-   MCHC: Mean Cell Hemoglobin Concentration, this is the average concentration of hemoglobin in a given volume of blood.

-   MCV: Mean Corpuscular Volume, this is the measure of the average size of the red clood cells

-   RDW: red cell distribution width. it is the differences in the volume and size of the red blood cells

-   Leucocyte

-   Platelets

-   Neutrophils

-   Basophils

-   Lymphocyte

-   PT: measure of the time it takes the liquid portion of the blood to clot.

-   INR

-   NT_proBNP: a measure of heart failure.

-   Creatine_kinase

-   Creatinine

-   Urea_nitrogen

-   glucose

-   Blood_potassium

-   Blood_sodium

-   Blood_calcium

-   Chloride

-   Anion_gap: measures the difference between the negatively and positively charged electrolytes in the blood.

-   Magnesium_ion

-   PH

-   Bicarbonate

-   Lactic_acid

-   PCO2: Partial Pressure of Carbon Dioxide, this measures the carbondioxide within the arterial or venous blood.

-   EF: Ejection Fraction: Used to gauge how healthy the heart is. It is the amount of blood that the heart pumps each time it beats.

# Descriptive Stats Questions

Based on the data available the following questions will be answered:

1.   Which age group is the most in the hospital?

2.   which age group of patients dies more in the hospital?

3.   which gender is the most prevalent in the hospital?

4.   which gender group is having the highest number of death?

5.   how many patients died in the hospital with atrial fibrillation?

6.   how many patients in the hospital have depression?

7.   what is the rate of non-survived patients with hypertension?

8.   Rate of gender with hypertension

9.   How many patients with renal failure are alive in the hospital?

10.   how many patients in the hospital with Hyperlipemia are dead?

11.   how many patients in the hospital with Anemia are dead?

12.   What is the proportion of survival and non-survival between diabetic and non-diabetic patients

13.  What is the proportion of survival and non-survival between depressed and non-depressed patients

# Data Preparation and Preprocessing

> **Note:** The PostgreSQL code solution to the descriptive statistic questions asked are
> [here](https://raw.githubusercontent.com/xrander/Health-data/master/Health_data_analysis.sql)

##Understanding the Data
It is important we understand the data

### The Data Structure
```{r data_structure,message=FALSE}
# data structure
str(health_rec)
```
At first glance, all the variables are numeric type. There are `r dim(health_rec)[1]` observations and `r dim(health_rec)[2]` variables. Some of the variables of the data does not follow the data definition. A quick descriptive summary of the data shows this.

```{r data_stats}
# quick descriptive statistics of the data
summary(health_rec)
```

We can expect two categories of data type according to the data description. The first is categorical variables for data which min is 0 and max is 1, and the other is numeric variables.

The descriptive statistics also shows the min and max age as `r min(health_rec$age)` and `r max(health_rec$age)`.

### Missing values
Next, we investigate the data for missing values. It is alright to have some missing values for some variables, but the outcome should be known, as it is important to see if patients are dead or alive. Outcome will be used to handle the missing data.
```{r remove_na}
# Remove missing data from the outcome variable
health_rec <- health_rec%>%
  filter(!is.na(outcome))
```

There is no missing data present in the outcome of patients. The data have been reduced from 1177 to `dim(health_rec)[1]`.
To deal with missing values from the other variables other than outcome, we need to know the missing value for the categorical and numeric variable and take the necessary steps.
```{r categorical_variables}
categorical <- health_rec %>%
  select(gender, hypertensive:COPD)

unique(is.na(categorical))
```
The categorical variables do not have missing values.

For the numerical variable, the descriptive statistics carried out earlier shows that some numerical variables contains missing values
```{r numerical_variables}
numerical <- health_rec %>%
  select(-colnames(categorical), -c(1:4))

str(numerical)
```
We are going to impute the missing values in the numerical variables using their mean. We use the e1071 package **impute()** to impute the means here.

```{r}
imputed_means <- numerical %>%
  impute(what = "mean")
```

Next we replace the old values with new ones in the main data frame. In the process, the group_num and ID column were also removed.
```{r}
health_rec_clean <- health_rec %>%
  select(-c(1,2),-c(names(numerical))) %>%
  bind_cols(imputed_means)
```

Now we check to find if there are still missing values.
```{r}
unique(is.na(health_rec_clean))
```
All numerical variable missing values are replaced by their means.

# Exploratory Data Analysis
A majority of the question asked are descriptive statistics questions and answers will be provided using visualization and tables.

## Descriptive Statistics
### Age
**The age group with the highest frequency**: To do this, we have to bin the age variable, creating a class range, then we can create a summary of the age_group and see their frequency
```{r age_group_frequency}
# Create bins
age_categories <- seq(0, 120, by = 20) # We assume the highest age is not above 120 years old

# Create age interval variable
health_rec_clean <- health_rec_clean %>%
  mutate(age_group = cut(age,
                         breaks = age_categories,
                         include.lowest = T, # To indicate if x is the lowest
                         ordered_result = F),#This ensures that the factor variable is not ordered
         age_group =  ifelse(age_group == "[0,20]", "0-20",
                             ifelse(age_group == "(20,40]", "20-40",
                                    ifelse(age_group == "(40,60]", "40-60",
                                           ifelse(age_group == "(60,80]", "60-80", "80-100")))), # Change the group names to ensure consistency
         age_group = factor(age_group, levels = c("0-20", "20-40","40-60", "60-80", "80-100"))) 



health_rec_clean %>%
  group_by(age_group) %>%
  summarize(frequency = n())
```

Older people are the highest in the hospital, with people between 60 - 80 years old having being the highest in the clinic and people more than 80 years old being the next most occurring patients.
To know the age(not age group) that is most occurring, we can simply group by the age them.

```{r}
health_rec_clean %>%
  group_by(age) %>%
  summarize(frequency = n()) %>%
  slice_max(order_by = frequency, n = 3)
```
The highest count of patients in the clinic are aged 89, 84 and 81 years respectively.

**Death Count of both genders**
```{r message=FALSE}
health_rec_clean %>%
  filter(outcome == 1) %>%
  group_by(gender, age_group) %>%
  summarize(dead_patients = length(outcome)) %>%
  arrange(desc(dead_patients)) %>%
  ggplot(aes(age_group, dead_patients, fill = factor(gender))) +
  geom_col(position = "dodge")+
  scale_fill_manual(values = c("tomato2", "thistle4"),
                    labels = c("Male", "Female"))+
  labs(x = "Age group",
       y = "Dead patients",
       fill = "Gender",
       title = "Dead counts across the different gender")+
  expand_limits(y = c(0, 40))+
  theme_bw()
```

The chart shows the dead patients according to age group and gender. The age group 80-100 years for females have the highest count of death.

The gender with the highest count in the clinic is the female gender as show below
```{r frequency of gender}
health_rec_clean %>%
  select(gender) %>%
  mutate(gender = ifelse(gender == 1, "Male", "Female")) %>%
  group_by(gender) %>%
  count()
```

what is the death rate of both gender

```{r}
health_rec_clean %>%
  mutate(outcome = ifelse(outcome == 0, "Alive", "Dead"),
         gender = ifelse(gender == 1, "Male", "Female")) %>%
  group_by(gender, outcome, age_group) %>%
  count() %>%
  pivot_wider(names_from = outcome,
              values_from = n,
              values_fill = 0) %>%
  mutate(total = sum(Alive, Dead),
         death_per_100 = Dead/100,
         death_ratio = round(Dead/total, 2))
```
The male gender have higher number of death.

### Disease and Death
Now we will investigate the 159 death occurrences that is present in the clinic and relate it to some of the diseases.

```{r}
dead_patients <- health_rec_clean %>%
  filter(outcome == 1) %>%
  select(outcome:COPD)
```

**Tidying the data for visualization**
```{r}
dead_patients_tidy <- dead_patients %>%
  pivot_longer(cols = c(hypertensive:COPD),
               names_to = "diseases",
               values_to = "state") %>%
  mutate(outcome = ifelse(outcome == 0, "Alive", "Dead"),
         gender = ifelse(gender == 1, "Male", "Female"),
         state = ifelse(diseases == "Renal_failure", "Not having", "Having"),
         state = ifelse(diseases != "Renal_failure", "Having", "Not Having"))
```

```{r}
dead_patients_tidy %>%
  ggplot(aes(state, fill = gender))+
  geom_bar(position = "dodge")+
  scale_fill_manual(values = c("tan", "olivedrab"))+
  facet_wrap(~diseases, scales = "free_y")+
  theme_bw()
```

##  Correlation Analysis
```{r}
correlation_plot <- cor(health_rec_clean[,c(1:2, 13:49)])

ggplot(melt(correlation_plot), aes(Var1, Var2, fill = value, label = round(value,1)))+
  geom_tile()+
  geom_text(aes(label= ifelse(value>0.5, as.character(round(value, 1)), "")))+
  scale_fill_gradient(low = "tomato",
                      high = "skyblue")+
  labs(title = "Correlation plot of variables")+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))
```




[Back to Homepage](https://olamideadu.com)
